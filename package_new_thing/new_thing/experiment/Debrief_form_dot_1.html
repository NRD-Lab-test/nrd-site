<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>NRD Debrief</title>
  </head>
  <style>
    body,html {
 font-family: 'Trebuchet MS', !important;
  height:90%;
    }
    #wrapper {
    width: 500px;
    float:inherit;
}
  .more {
  cursor:pointer;
}
</style>
  <body>
<script>function send_csv_file(obj){
    SID=getCookie("id");
    exp_name=getCookie("exp");
    console.log(SID)
    console.log(exp_name)
    csv_name=csv_name(exp_name,SID);
    csv_file=CsvFormatting(obj);
    send_csv("http://ec2-3-21-100-180.us-east-2.compute.amazonaws.com:3000",csv_name,csv_file);};

  function csv_name(exp_name,SID){
    return String(exp_name)+"-"+String(SID)+".csv"
  };

  function send_csv(server_loc, csv_name,csv_file){
  var url=new Blob([csv_file], { type: 'text/csv;charset=utf-8;' });
  console.log(url)
  var fd=new FormData();
  fd.append("upl",url,csv_name);
  fetch(server_loc,{
  method:"POST",
  body: fd})
  .then((response)=>{
    responded=response.json();
  console.log(responded)})
  .catch((error)=>{
    console.error("error:",error)
  })};

  function CsvFormatting(obj){
  var stringline='';
  var number_of_times=obj[Object.keys(obj)[0]].length;
  var keys = Object.keys(obj);
  var completeString=[]
  var stringToAdd='';
  for (var k=0; k<keys.length; k++){
      if (k==keys.length-1){
          stringToAdd+='"'+keys[k]+'"'
      }else{
          stringToAdd+='"'+keys[k]+'",';}
      }
  stringToAdd+="\n";
  completeString.push(stringToAdd);
  stringToAdd='';
  for (var i=0; i<number_of_times; i++){
      stringToAdd=''
      for (var j=0; j<keys.length; j++){
          if (j==keys.length-1){
              stringToAdd+='"'+JSON.stringify(obj[keys[j]][i])+'"';
          }
          else{
              stringToAdd+='"'+JSON.stringify(obj[keys[j]][i])+'",';
          };
      };
  completeString.push(stringToAdd);
  };
  var csv=completeString.join("\n");
  return csv
  };

  function getCookie(cname) {
  var name = cname + "=";
  var decodedCookie = decodeURIComponent(document.cookie);
  var ca = decodedCookie.split(',');
  for(var i = 0; i <ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}</script>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">NRD Lab</a>
        
      </nav>
      <div class="container h-100">
        <div class="row h-100 justify-content-center align-items-center">
            <object data="empty" type="application/pdf" width="100%" height="100%">  
              </object>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="1" id="defaultCheck2" onclick="verify_checked()">
            <label class="form-check-label" for="defaultCheck2">
              I have read this form
            </label>
          </div>
          <div class="btn btn-primary btn-lg more" onclick="redirect()">Submit</div>
      </div>
      <script>
          var actions={checked_box:false}
          function verify_checked(){
              if (actions.checked_box){
                actions.checked_box=false;
              }
              else {
                actions.checked_box=true;
              };
              console.log(actions.checked_box)
          }
          function redirect(){
              if (actions.checked_box){
                  console.log("success")
                  var placement=getCookie("register_loc")
                  var id=getCookie("id")
                  console.log(document.cookie)
                  if (placement=="sona"){
                    location.href ="../fake_qualtircs/fake_qualtrics.html/?id="+id;
                  }
                  else{
                    location.href = "../../global_html/back_to_experiment.html"
                  }}              }
              function getCookie(cname) {
                var name = cname + "=";
                var decodedCookie = decodeURIComponent(document.cookie);
                var ca = decodedCookie.split(',');
                for(var i = 0; i <ca.length; i++) {
                  var c = ca[i];
                  while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                  }
                  if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                  }
                }
                return "";
}
            
      </script>
        <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
  </html>