<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <style>
        .ann_outer {
            margin:0px;
            width:400px;
            height:400px;
            background-color:transparent;
            position: absolute;
            top:0px;
            left:0px;
            border-radius:50%;
            border: transparent;
        }
        .red_dot {
            margin:0px;
            width: 34px;
            height: 34px;
            background-color:transparent;
            position: absolute;
            top:0px;
            left:0px;
            border-radius:50%;
        } 
        .gate {
            margin:0px;
            width:60px;
            height:60px;
            background-color:transparent;
            position: absolute;
            top:0px;
            left:0px;
            border-radius:50%;
            border: transparent;
            fill: transparent;
        }
        .header {
            left:60px;
            top:60px;
            text-align: center;
            color: white;
            font-size: 30px;
            position:absolute;
        }
        .pointMarkers {
            left:60px;
            top:60px;
            text-align: center;
            color: white;
            font-size: 25px;
            position:absolute;
        }
        .bars {
        top: 58px;
        width: 100px;
        height: 40px;
        background: transparent;
        border-radius: 0%;
        position: absolute;
        border: transparent;
        }
    </style>

</head>
<body style="background-color: black;">
<script>function send_csv_file(obj){
    SID=getCookie("id");
    exp_name=getCookie("exp");
    console.log(SID)
    console.log(exp_name)
    csv_name=csv_name(exp_name,SID);
    csv_file=CsvFormatting(obj);
    send_csv("http://ec2-3-21-100-180.us-east-2.compute.amazonaws.com:3000",csv_name,csv_file);};

  function csv_name(exp_name,SID){
    return String(exp_name)+"-"+String(SID)+".csv"
  };

  function send_csv(server_loc, csv_name,csv_file){
  var url=new Blob([csv_file], { type: 'text/csv;charset=utf-8;' });
  console.log(url)
  var fd=new FormData();
  fd.append("upl",url,csv_name);
  fetch(server_loc,{
  method:"POST",
  body: fd})
  .then((response)=>{
    responded=response.json();
  console.log(responded)})
  .catch((error)=>{
    console.error("error:",error)
  })};

  function CsvFormatting(obj){
  var stringline='';
  var number_of_times=obj[Object.keys(obj)[0]].length;
  var keys = Object.keys(obj);
  var completeString=[]
  var stringToAdd='';
  for (var k=0; k<keys.length; k++){
      if (k==keys.length-1){
          stringToAdd+='"'+keys[k]+'"'
      }else{
          stringToAdd+='"'+keys[k]+'",';}
      }
  stringToAdd+="\n";
  completeString.push(stringToAdd);
  stringToAdd='';
  for (var i=0; i<number_of_times; i++){
      stringToAdd=''
      for (var j=0; j<keys.length; j++){
          if (j==keys.length-1){
              stringToAdd+='"'+JSON.stringify(obj[keys[j]][i])+'"';
          }
          else{
              stringToAdd+='"'+JSON.stringify(obj[keys[j]][i])+'",';
          };
      };
  completeString.push(stringToAdd);
  };
  var csv=completeString.join("\n");
  return csv
  };

  function getCookie(cname) {
  var name = cname + "=";
  var decodedCookie = decodeURIComponent(document.cookie);
  var ca = decodedCookie.split(',');
  for(var i = 0; i <ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}</script>
<div class="ann_outer", id="outer_ann"></div>
<div class="gate", id="gate"></div>
<div class="gate", id="preGate"></div>
<div class="red_dot", id="redDot"></div>
<div class="header", id="innerMsg"><h1> </h1><p> </p></div>
<div class="pointMarkers", id="gateMSG"><h1> </h1><p> </p></div>
<div class="pointMarkers", id="pgateMSG"><h1> </h1><p> </p></div>
<div class="pointMarkers", id="earnings"><h1> </h1><p> </p></div>
<div class="pointMarkers", id="multi"><h1> </h1><p> </p></div>
<div class="bars", id="pBarOut"></div>
<div class="bars", id="pBarF"></div>
<div class="bars", id="tBarOut"></div>
<div class="bars", id="tBarF"></div>
<div class="pointMarkers", id="points"><h1> </h1><p> </p></div>
<div class="pointMarkers", id="trials"><h1> </h1><p> </p></div>

 <h2 id="instructions", style=color:white;></h2>


 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@2.3.2/dist/email.min.js"></script>
 <script type="text/javascript">
    (function(){
       emailjs.init("user_nWoTiPblTe0mMxLHE7S7P");
    })();
 </script>

<script>
    var exp="gate_1"
    var SID="12343"
    var email="hello@gmail.com"
    document.cookie="register_loc=qe , exp="+exp+" , id="+SID+" , email="+email+"; path=/"
   document.getElementById("pBarOut").style.border="transparent";
    document.getElementById("tBarOut").style.border="transparent";
    document.getElementById("pBarF").style.top=59+"px";
    document.getElementById("trials").style.top=120+"px";
    document.getElementById("tBarOut").style.top=118+"px";
    document.getElementById("tBarF").style.top=119+"px";
    document.getElementById("pBarF").style.backgroundColor="transparent";
    document.getElementById("tBarF").style.backgroundColor="transparent";

    document.addEventListener("keydown",function(e){
            if (e.key==" "){
                trialParams.go=true
            };
        })

    var trialParams={time:0,centerH:0,centerW:0,go:false,goSig:false,speedT:0,offset:0,feedTime:NaN,feedBackTime:300,pressTime:0,multCheck:[]};
    var speeds={slow:4000,fast:2000,pDistribution:.85,interval:0};
    var startTime, elapsedTime, keyTime=0;
    var instructions={doIns:true,insStart:true,insCirc:false,insMove:false,mech:false,mech1:false,explanation:false,explanation1:false,complete:false,pauseT:NaN};
    var triggers={p1:true,p2:false,p3:false,p4:false,play:false,randomLocs:true,newStart:0,feedback:false,feedComp:false};
    var nTrials=3;
    var nPoints=3000;
    var ii=0;
    var success=0;
    var pointsT=0;
    var multiplier=1;
    var earned=0;
    var trialLog={success:[],speed:[],startTime:[],stopSpin:[],preSuc:[],dot1:[],dot2:[],gate1:[],gate2:[],offset:[],mult:[],poits:[]};
    var neededNums={gate:0,ann:0,arcA:0,arcL:0};
    var locations={gate1T:0,gate1L:0,gate2T:0,gate2L:0,dotT:0,dotL:0};
    var dims={ann:400,gate:60,dot:34,iPrep:0};

    dims.iPrep=3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989;

    function start(){
    startTime = Date.now();
    elapsedTime = setInterval(function(){
        updateDisplay(Date.now() - startTime);
        },1);
    }
    function stop(){
    clearInterval(elapsedTime);
    }

    trialParams.centerW= Math.floor(window.innerWidth/2);
    trialParams.centerH=Math.floor(window.innerHeight/2);
    document.getElementById("innerMsg").style.top=trialParams.centerH+"px";
    document.getElementById("innerMsg").style.left=trialParams.centerW+"px";

    document.getElementById("earnings").style.top=60+"px";
    document.getElementById("multi").style.top=120+"px";
    document.getElementById("earnings").style.left=trialParams.centerW+"px";
    document.getElementById("multi").style.left=trialParams.centerW+"px";    
    document.getElementById("points").style.left=(trialParams.centerW/3)+"px";
    document.getElementById("trials").style.left=(trialParams.centerW/3)+"px";
    document.getElementById("pBarOut").style.width=trialParams.centerW-20+"px";
    document.getElementById("tBarOut").style.width=trialParams.centerW-20+"px";


    start()

    function updateDisplay(elapsedTime){
        if (instructions.doIns){
        if (instructions.insStart){
            document.getElementById("instructions").innerHTML="Thank you for participating in this experiment. Please press space to continue."
        }
        if (trialParams.goSig && instructions.insStart){
            trialParams.goSig=false;
            instructions.insStart=false;
            instructions.insCirc=true;
        }
        if (instructions.insCirc){
        document.getElementById("instructions").innerHTML="The white circle is a track that the red dot will travel along. When you press space, \
        the red dot will start moving around the white circle at a constant speed. \
        This speed can change with each trial but is constant in each trial. \
        Your goal is to stop the red circle inside the green gate by pressing space as the dot passes through the green circle \
        (usually you will be able to stop the dot anywhere, but for now let's get it in the green circle). \
        Please press space to continue."
        document.getElementById("outer_ann").style.left=trialParams.centerW-(dims.ann/2)+"px";
        document.getElementById("outer_ann").style.top=trialParams.centerH-(dims.ann/2)+"px";
        document.getElementById("outer_ann").style.border = "thin solid white";
        locations.dotL=(dims.ann/2)*Math.cos(0)+trialParams.centerW-(dims.dot/2);
        locations.dotT=-(dims.ann/2)*Math.sin(0)+trialParams.centerH-(dims.dot/2);
        document.getElementById("redDot").style.left=locations.dotL+"px";
        document.getElementById("redDot").style.top=locations.dotT+"px";
        document.getElementById("redDot").style.backgroundColor="red";
        locations.gate1L=(dims.ann/2)*Math.cos(0)+(trialParams.centerW)-(dims.gate/2);
        locations.gate1T=-(dims.ann/2)*Math.sin(0)+(trialParams.centerH)-(dims.gate/2);
        document.getElementById("gate").style.left=locations.gate1L+"px";
        document.getElementById("gate").style.top=locations.gate1T+"px";
        }        
        if (trialParams.goSig && instructions.insCirc){
            trialParams.time=elapsedTime;
            trialParams.goSig=false;
            instructions.insCirc=false;
            instructions.insMove=true;
        }
        if (instructions.insMove){
        document.getElementById("gate").style.border="thick solid green";
        speeds.interval=2*dims.iPrep/4000;
        locations.dotL=(dims.ann/2)*Math.cos(0+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerW-(dims.dot/2);
        locations.dotT=-(dims.ann/2)*Math.sin(0+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerH-(dims.dot/2);
        document.getElementById("redDot").style.left=locations.dotL+"px";
        document.getElementById("redDot").style.top=locations.dotT+"px";
        }
        if (trialParams.goSig && instructions.insMove){
            if (Math.sqrt(Math.pow(((locations.gate1L+(dims.gate/2))-(locations.dotL+(dims.dot/2))),2)+Math.pow(((locations.gate1T+(dims.gate/2))-(locations.dotT+(dims.dot/2))),2)) <(dims.gate/2) ){
        instructions.insMove=false;
        trialParams.goSig=false;
        instructions.pauseT=elapsedTime;
        }}
        if ((elapsedTime > instructions.pauseT+1000) && !instructions.mech){
        document.getElementById("gate").style.border="transparent";
        instructions.mech=true;
        instructions.pauseT=NaN;
        }
        
        if(instructions.mech){
        document.getElementById("instructions").innerHTML="This time the dot will disapear and and the green gate will apear after making ONE full rotation. Your goal is to press space when you think the dot is inside the green circle. If you do not predict correctly, the dot will flash. Press space to start."
        if(trialParams.goSig && instructions.mech){
            instructions.mech=false;
            instructions.mech1=true;
            trialParams.goSig=false;
            trialParams.time=elapsedTime;
        }
        }
        if (instructions.mech1){
        if (elapsedTime < (trialParams.time+4000)){
            trialParams.goSig=false;
        }
        document.getElementById("instructions").innerHTML="Once the dot has disapeared (one full rotation), press space to guess the location of the dot.The dot will be revealed if your guess is wrong. The dot will stop if your guess is right."
        locations.dotL=(dims.ann/2)*Math.cos(0+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerW-(dims.dot/2);
        locations.dotT=-(dims.ann/2)*Math.sin(0+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerH-(dims.dot/2);
        document.getElementById("redDot").style.left=locations.dotL+"px";
        document.getElementById("redDot").style.top=locations.dotT+"px";
        if (elapsedTime > (trialParams.time+4000)){
            document.getElementById("redDot").style.backgroundColor="transparent";
            document.getElementById("gate").style.border="thick solid green";
            if (!triggers.feedback){
            if (trialParams.goSig){
                if (Math.sqrt(Math.pow(((locations.gate1L+(dims.gate/2))-(locations.dotL+(dims.dot/2))),2)+Math.pow(((locations.gate1T+(dims.gate/2))-(locations.dotT+(dims.dot/2))),2)) <(dims.gate/2) ){
                    document.getElementById("redDot").style.backgroundColor="red";
                    instructions.mech1=false;
                    trialParams.goSig=false;
                    instructions.explanation=true
                }else{
                    trialParams.feedTime=elapsedTime;
                    trialParams.goSig=false;
                }
            }}
            if (elapsedTime < trialParams.feedTime+trialParams.feedBackTime){
            triggers.feedback=true;
            }else{
            triggers.feedback=false;
            }
            if (triggers.feedback){
            document.getElementById("redDot").style.backgroundColor="red";
            }
        }
        }
        if(instructions.explanation){
            document.getElementById("redDot").style.backgroundColor="transparent";
            document.getElementById("outer_ann").style.border = "transparent";
            document.getElementById("gate").style.border="transparent";
            document.getElementById("instructions").innerHTML="During the experiment, a yellow and green gate will appear after one full rotation of the dot around the circle. \
            The goal is ALWAYS to stop the red dot in the green gate. You can flash the red dot once durring each trial by pressing the space bar. \
            The second time the space bar is pressed, it will stop the dot.\
            You will either do "+nTrials+" trials or earn "+
            nPoints+" points. Points are earned by successfully predicting when the dot is inside the green circle. You can multiply the amout of points you earn by \
            successfully starting the flash when the dot is in the yellow circle. Points earned and multiplier will varry each trial. Press space to start the experiment.";
            if(trialParams.goSig && !instructions.explanation1){
            trialParams.goSig=false;
            instructions.explanation1=true;
            instructions.explanation=false;
            instructions.complete=true;
            }
        }
        }

 


        // do your stuff 
        if (instructions.complete){
        document.getElementById("points").innerHTML="Score:"+pointsT+"/"+nPoints;
        document.getElementById("trials").innerHTML="Trials:"+ii+"/"+nTrials;
        document.getElementById("pBarF").style.width=((trialParams.centerW-20)*(pointsT/nPoints))+"px";
        document.getElementById("tBarF").style.width=((trialParams.centerW-20)*(ii/nTrials))+"px";
        document.getElementById("pBarOut").style.border="thin solid white";
        document.getElementById("tBarOut").style.border="thin solid white";
        document.getElementById("pBarF").style.top=59+"px";
        document.getElementById("trials").style.top=120+"px";
        document.getElementById("tBarOut").style.top=118+"px";
        document.getElementById("tBarF").style.top=119+"px";
        document.getElementById("pBarF").style.backgroundColor="blue";
        document.getElementById("tBarF").style.backgroundColor="green";

        if (triggers.randomLocs) {
            trialParams.multCheck=false;
        document.getElementById("redDot").style.backgroundColor="transparent";            
        document.getElementById("gate").style.border="transparent";
        document.getElementById("preGate").style.border="transparent";
        document.getElementById("pgateMSG").style.color="white";
        document.getElementById("innerMsg").innerHTML=" ";
        document.getElementById("gateMSG").innerHTML=" ";
        document.getElementById("pgateMSG").innerHTML=" ";
        trialParams.dotSlocx=2*Math.PI*Math.random();
        trialParams.pgateSlocx=trialParams.dotSlocx+getRandomArbitrary(.78, 2.5);
        trialParams.gateSlocx=trialParams.pgateSlocx+getRandomArbitrary(1, Math.PI);        
        locations.dotL=(dims.ann/2)*Math.cos(trialParams.dotSlocx)+trialParams.centerW-(dims.dot/2);
        locations.dotT=-(dims.ann/2)*Math.sin(trialParams.dotSlocx)+trialParams.centerH-(dims.dot/2);
        document.getElementById("redDot").style.left=locations.dotL+"px";
        document.getElementById("redDot").style.top=locations.dotT+"px";
        
        trialParams.rngSpeed=Math.random();
        if (trialParams.rngSpeed < speeds.pDistribution){
        trialParams.speedT=speeds.slow;
        speeds.interval=2*dims.iPrep/trialParams.speedT;
        }else {
        trialParams.speedT=speeds.fast;
        speeds.interval=2*dims.iPrep/trialParams.speedT;
        }
//change here from origonal 
        trialLog.gate1.push(trialParams.gateSlocx);
        trialLog.gate2.push(trialParams.pgateSlocx);

        if (ii>25){
        if (Math.random() < .75){
        trialParams.offset=.25*Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random());
        }else{ 
        trialParams.offset=0;
        }
        }else{
        trialParams.offset=0;
        }
        
        trialLog.offset.push(trialParams.offset);
        console.log(trialLog.offset);
        earned=getRandomInt(10, 50);
        multiplier=getRandomArbitrary(1.5, 3.5);        
        trialLog.mult.push(multiplier)
        trialLog.poits.push(earned)
        document.getElementById("earnings").innerHTML="Possible points:"+earned;
        document.getElementById("multi").innerHTML="Possible multiplier:"+multiplier.toFixed(2);
        triggers.randomLocs=false;
        triggers.p1=true;
        }

        if (triggers.p1) {
        document.getElementById("instructions").innerHTML="Press space to start trial.";
        document.getElementById("outer_ann").style.left=trialParams.centerW-(dims.ann/2)+"px";
        document.getElementById("outer_ann").style.top=trialParams.centerH-(dims.ann/2)+"px";
        document.getElementById("outer_ann").style.border = "thin solid white";
        triggers.p1=false;
        triggers.p2=true;
        trialParams.goSig=false
        }
        if (triggers.p2){
        locations.gate1L=(dims.ann/2)*Math.cos(trialParams.gateSlocx)+(trialParams.centerW)-(dims.gate/2);
        locations.gate1T=-(dims.ann/2)*Math.sin(trialParams.gateSlocx)+(trialParams.centerH)-(dims.gate/2);
        locations.gate2L=(dims.ann/2)*Math.cos(trialParams.pgateSlocx)+(trialParams.centerW)-(dims.gate/2);
        locations.gate2T=-(dims.ann/2)*Math.sin(trialParams.pgateSlocx)+(trialParams.centerH)-(dims.gate/2);

        document.getElementById("gateMSG").style.left=locations.gate1L+(dims.gate)+"px";
        document.getElementById("gateMSG").style.top=locations.gate1T+(dims.gate)+"px";

        document.getElementById("pgateMSG").style.left=locations.gate2L+(dims.gate)+"px";
        document.getElementById("pgateMSG").style.top=locations.gate2T+(dims.gate)+"px"


        document.getElementById("gate").style.left=locations.gate1L+"px";
        document.getElementById("gate").style.top=locations.gate1T+"px";
        document.getElementById("preGate").style.left=locations.gate2L+"px";
        document.getElementById("preGate").style.top=locations.gate2T+"px";
        document.getElementById("redDot").style.backgroundColor="red";
        triggers.p2=false;
        triggers.p3=true;
        }

        if (triggers.play){
            document.getElementById("instructions").innerHTML="After the dot disapears, press space to flash dot (yellow for multiplier).";
        if (trialParams.goSig && (elapsedTime < trialParams.time+trialParams.speedT)){
            trialParams.goSig=false;
        }
        if (trialParams.goSig && !triggers.feedComp && (elapsedTime > trialParams.time+trialParams.speedT)){
            trialParams.pressTime=(elapsedTime-trialParams.time);
            trialLog.dot2.push(trialParams.dotSlocx+(speeds.interval*trialParams.pressTime));
            //checker=makeArr((trialParams.dotSlocx+(speeds.interval*trialParams.pressTime)), (trialParams.dotSlocx+(speeds.interval*(trialParams.pressTime+trialParams.feedBackTime))), trialParams.feedBackTime)
            //for (var ic = 0; ic < trialParams.feedBackTime; ic++){
            //}
            trialParams.feedTime=elapsedTime;
            trialParams.goSig=false;
        }
        if (elapsedTime < trialParams.feedTime+trialParams.feedBackTime){
            triggers.feedback=true;
        }else{
            triggers.feedback=false;
            //document.getElementById("innerMsg").innerHTML=" ";
        }
        if (elapsedTime > trialParams.feedTime+trialParams.feedBackTime){ 
            document.getElementById("instructions").innerHTML="Press space to stop dot (green for success).";
            if (!trialParams.multCheck){
                multiplier=1;
                document.getElementById("innerMsg").innerHTML="Multiplier lost";
                document.getElementById("innerMsg").style.top=trialParams.centerH-(34/2)+"px";
                document.getElementById("innerMsg").style.left=trialParams.centerW-(172.500/2)+"px";
                document.getElementById("innerMsg").style.color="red";
                document.getElementById("multi").innerHTML="possible multiplier:"+multiplier.toFixed(2);
                document.getElementById("pgateMSG").style.color="red";
            }
            triggers.feedComp=true;
        }
        if (triggers.feedComp && !trialParams.multCheck){
            trialLog.preSuc.push(0);
            trialParams.multCheck=true;
        }
        
        if (elapsedTime > trialParams.time+trialParams.speedT && !triggers.feedback){
            document.getElementById("gate").style.border="thick solid green";
            document.getElementById("preGate").style.border="thin solid yellow";
            document.getElementById("redDot").style.backgroundColor="transparent";
            document.getElementById("gateMSG").innerHTML=earned+"pts";
            document.getElementById("pgateMSG").innerHTML="x"+multiplier.toFixed(2);
        }
        if (!triggers.feedback){
            locations.dotL=(dims.ann/2)*Math.cos(trialParams.dotSlocx+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerW-(dims.dot/2);
            locations.dotT=-(dims.ann/2)*Math.sin(trialParams.dotSlocx+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerH-(dims.dot/2);
            document.getElementById("redDot").style.left=locations.dotL+"px";
            document.getElementById("redDot").style.top=locations.dotT+"px";
        }
        if (elapsedTime > trialParams.time+trialParams.speedT && triggers.feedback){
            if (!trialParams.multCheck){            
            locations.dot1L=(dims.ann/2)*Math.cos(trialParams.dotSlocx+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerW-(dims.dot/2);
            locations.dot1T=-(dims.ann/2)*Math.sin(trialParams.dotSlocx+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerH-(dims.dot/2);
            if (Math.sqrt(Math.pow(((locations.gate2L+(dims.gate/2))-(locations.dot1L+(dims.dot/2))),2)+Math.pow(((locations.gate2T+(dims.gate/2))-(locations.dot1T+(dims.dot/2))),2)) <(dims.gate/2) ){
                trialLog.preSuc.push(1);
                document.getElementById("innerMsg").innerHTML="Multiplier earned";
                document.getElementById("innerMsg").style.top=trialParams.centerH-(34/2)+"px";
                document.getElementById("innerMsg").style.left=trialParams.centerW-(209.2/2)+"px";
                document.getElementById("innerMsg").style.color="green";
                document.getElementById("pgateMSG").style.color="green";
                trialParams.multCheck=true;
            }}
            document.getElementById("redDot").style.backgroundColor="red";
            locations.dotL=(dims.ann/2)*Math.cos(trialParams.offset+trialParams.dotSlocx+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerW-(dims.dot/2);
            locations.dotT=-(dims.ann/2)*Math.sin(trialParams.offset+trialParams.dotSlocx+(speeds.interval*(elapsedTime-trialParams.time)))+trialParams.centerH-(dims.dot/2);
            document.getElementById("redDot").style.left=locations.dotL+"px";
            document.getElementById("redDot").style.top=locations.dotT+"px";
        }
        }
        if (trialParams.goSig && triggers.p3){
        trialParams.feedTime=NaN;
        triggers.feedComp=false;
        triggers.p3=false;
        trialParams.goSig=false
        triggers.play=true;
        trialParams.time=elapsedTime;
        }


        if (trialParams.goSig && triggers.play && triggers.feedComp) {
            document.getElementById("redDot").style.backgroundColor="red";
            trialLog.dot1.push(trialParams.dotSlocx+(speeds.interval*(elapsedTime-trialParams.time)));
            trialLog.stopSpin.push(elapsedTime);
            triggers.play=false;
            triggers.newStart=elapsedTime;
            ii=ii+1;
            trialParams.goSig=false;
            if 
            (Math.sqrt(Math.pow(((locations.gate1L+(dims.gate/2))-(locations.dotL+(dims.dot/2))),2)+Math.pow(((locations.gate1T+(dims.gate/2))-(locations.dotT+(dims.dot/2))),2)) <(dims.gate/2) ){
                trialLog.success.push(1);
                pointsT=pointsT+Math.ceil((earned*multiplier));
                document.getElementById("innerMsg").innerHTML="Points earned";
                document.getElementById("innerMsg").style.top=trialParams.centerH-(34/2)+"px";
                document.getElementById("innerMsg").style.left=trialParams.centerW-(162.469/2)+"px";
                document.getElementById("innerMsg").style.color="green";
                console.log(trialLog)
            }else{
                trialLog.success.push(0);
                document.getElementById("innerMsg").innerHTML="Target missed";
                document.getElementById("innerMsg").style.top=trialParams.centerH-(34/2)+"px";
                document.getElementById("innerMsg").style.left=trialParams.centerW-(166.484/2)+"px";
                document.getElementById("innerMsg").style.color="red";
                console.log(trialLog)
            }
            trialLog.speed.push(trialParams.speedT);
            trialLog.startTime.push(trialParams.time);
            
        }
        if ((elapsedTime > triggers.newStart+1000) && (triggers.newStart > trialParams.time)){
            triggers.feedComp=false;
            triggers.randomLocs=true;
            triggers.newStart=0;
        }
        if (triggers.goSig){console.log(Date.now())}
        if ((ii == nTrials || (pointsT >= nPoints))){
            stop() 
            var data_out_to_server=trialLog
send_csv_file(data_out_to_server)

        }
        
    }
    if (trialParams.go){
        if (elapsedTime > keyTime+trialParams.feedBackTime){
            trialParams.goSig=true;
            keyTime=elapsedTime;
        }
        trialParams.go=false;
    }
    }
    function makeArr(startValue, stopValue, cardinality) {
  var arr = [];
  var step = (stopValue - startValue) / (cardinality - 1);
  for (var i = 0; i < cardinality; i++) {
    arr.push(startValue + (step * i));
  }
  return arr;
}

function getRandomInt(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
}
function getRandomArbitrary(min, max) {
  return Math.random() * (max - min) + min;
}  

function CsvFormatting(obj){
  var stringline='';
  var number_of_times=obj[Object.keys(obj)[0]].length;
  var keys = Object.keys(obj);
  var completeString=[]
  var stringToAdd='';
  for (var k=0; k<keys.length; k++){
      if (k==keys.length-1){
          stringToAdd+='"'+keys[k]+'"'
      }else{
          stringToAdd+='"'+keys[k]+'",';}
      }
  stringToAdd+="\n";
  completeString.push(stringToAdd);
  stringToAdd='';
  for (var i=0; i<number_of_times; i++){
      stringToAdd=''
      for (var j=0; j<keys.length; j++){
          if (j==keys.length-1){
              stringToAdd+='"'+JSON.stringify(obj[keys[j]][i])+'"';
          }
          else{
              stringToAdd+='"'+JSON.stringify(obj[keys[j]][i])+'",';
          };
      };
  completeString.push(stringToAdd);
  };
  var csv=completeString.join("\n");
  return csv
  };
    </script>
<h2 id="instructions", style=color:white;></h2>

</body>
</html>